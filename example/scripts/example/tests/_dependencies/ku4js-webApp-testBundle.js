(function(c){$.ku4webApp_testBundle={};$.ku4webAppUT={};function b(){var h=$.ku4webApp_testBundle.app();this._mediator=h.mediator;this._app=h}b.prototype={mediator:function(){return this._mediator},logErrors:function(){this._mediator.logErrors();return this},throwErrors:function(){this._mediator.throwErrors();return this},callback:function(h){$.ku4webApp_testBundle.callback=h;return this},onModelCall:function(h){$.ku4webApp_testBundle.onModelCall=h;return this},model:function(h){var i=this._app.prodModel();return $.ku4webApp.models[h](this._mediator,i.serviceFactory,i.storeFactory,i.validatorFactory)},view:function(h){return $.ku4webApp.views[h](this._app.prodModel())},controller:function(h){return $.ku4webApp.controllers[h](this._app.stubModel())},template:function(h){return this._app.prodModel().templateFactory.create(h)}};$.ku4webAppUT.bundle=function(){return new b()};function f(){var h=$.ku4webApp;this.mediator=$.mediator();this.serviceFactory=$.ku4webApp_testBundle.serviceFactory(this.mediator,h.config.services);this.storeFactory=h.storeFactory(this.mediator,h.config.collections);this.validatorFactory=h.validatorFactory(h.config.validators);this.templateFactory=h.templateFactory(h.config.templates);this.formFactory=h.formFactory(h.config.forms);this.prodModel()}f.prototype={logErrors:function(){this.mediator.logErrors();return this},throwErrors:function(){this.mediator.throwErrors();return this},stubModel:function(){this.modelFactory=$.ku4webApp_testBundle.modelFactory(this.mediator,this.serviceFactory,this.storeFactory,this.validatorFactory);return this},prodModel:function(){this.modelFactory=$.ku4webApp.modelFactory(this.mediator,this.serviceFactory,this.storeFactory,this.validatorFactory);return this}};$.ku4webApp_testBundle.app=function(){return new f()};function g(j,h,l){var k=$.str.format("$.ku4webApp.{0}",j),i=$.str.format("Requires a valid {0}. {0}= {1}",h,l);if(!$.exists(l)){throw $.ku4exception(k,i)}else{return l}}$.ku4webApp_testBundle.onModelCall=function(){return};$.ku4webApp_testBundle.model=function(i,h,q,j,o){var p=$.ku4webApp.models[i](h,q,j,o),m={};function l(){$.ku4webApp_testBundle.onModelCall.apply(this,arguments);$.ku4webApp_testBundle.onModelCall=function(){return}}for(var k in p){m[k]=l}return m};function a(i,h){this._mediator=i;this._config=h}a.prototype={call:function(k){var i=this._config,l=$.ku4webApp_testBundle.callback||function(m){return m},h=l(k),j=/^__error__$/i.test(h);if(!$.exists(i)){throw $.ku4exception("$.service","Test Bundle services require a valid config containing a 'success':[data] and an 'error':[data] configuration.")}if($.exists(i.error)&&j){this._mediator.notify(h,i.error)}else{if($.exists(i.success)){this._mediator.notify(h,i.success)}}$.ku4webApp_testBundle.callback=function(m){return m};return this}};$.ku4webApp_testBundle.service=function(i,h){return new a(i,h)};function e(j,h,k,i){this._mediator=j;this._serviceFactory=h;this._storeFactory=k;this._validatorFactory=i}e.prototype={create:function(h){return $.ku4webApp_testBundle.model(h,this._mediator,this._serviceFactory,this._storeFactory,this._validatorFactory)}};$.ku4webApp_testBundle.modelFactory=function(j,h,k,i){return new e(j,h,k,i)};function d(i,h){this._mediator=i;this._config=h}d.prototype={create:function(h){return $.ku4webApp_testBundle.service(this._mediator,this._config[h])}};$.ku4webApp_testBundle.serviceFactory=function(i,h){return new d(i,h)}})();